---
title: "PHP Directory Server"
description: "List game servers using a shared PHP webhost as a lightweight alternative to running a dedicated master server."
---

<Callout type="warn">
**Deprecated:** This system has been supplanted by PHPDirectoryServer2. See the updated implementation in the samples.
</Callout>

### Use a shared webhost to list games

The [Lightweight Database](/plugins/lightweight-database) plugin is powerful, but requires an instance of RakNet running on a dedicated server. In some cases this is more than is needed and the burden of running a dedicated server is undesirable. For these instances, RakNet provides `DirectoryServer.php`, found under `Samples\PHPDirectoryServer`.

<Steps>
<Step>

### Upload the PHP script

Upload `Samples\PHPDirectoryServer\DirectoryServer.php` to your PHP capable webhost (which is any standard shared webhost). Go to your newly uploaded webpage, click the reveal button, and enter a password and other settings if desired.

</Step>

<Step>

### Set up TCPInterface

Create an instance of `TCPInterface` that is started. This is used for general TCP communication:

```cpp
TCPInterface tcp;
tcp.Start(0, 64);
```

</Step>

<Step>

### Set up HTTPConnection

Create an instance of `HTTPConnection`. This is used to communicate with webpages through `TCPInterface`:

```cpp
HTTPConnection httpConnection(tcp, "yourdomain.com");
```

</Step>

<Step>

### Set up PHPDirectoryServer

Create an instance of `PHPDirectoryServer`. This does parsing and communications that are specific to `DirectoryServer.php`:

```cpp
PHPDirectoryServer phpDirectoryServer(httpConnection, "/raknet/DirectoryServer.php");
```

</Step>

<Step>

### Set fields and upload/download

You can then set columns, upload your table, or download the existing tables:

```cpp
// Set fields with columnname / value
phpDirectoryServer.SetField("beehive", "inthewater");

// Upload previously set fields, along with required parameters:
// game name, game port, and password
phpDirectoryServer.UploadTable(50, "Game name", 1234, "");

// Download uploaded servers
phpDirectoryServer.DownloadTable("");
```

</Step>
</Steps>

To update the system, you should pass packets from `TCPInterface` to both interfaces and also call `Update()`. This is complicated by the fact that TCP packets may not contain an entire webpage response, the webpage may contain error codes, and not all messages from the webpage are necessarily relevant to our directory server. The sample demonstrates how to do this. The following is an abbreviated excerpt:

```cpp
Packet *packet = tcp.Receive();
if(packet)
{
    if (packet->systemAddress == httpConnection.GetServerAddress())
    {
        if (httpConnection.ProcessFinalTCPPacket(packet))
        {
            int code;
            RakNet::RakString data;
            if (httpConnection.HasBadResponse(&code, &data) == false)
            {
                HTTPReadResult readResult =
                    phpDirectoryServer.ProcessHTTPRead(httpResult);
                if (readResult == HTTP_RESULT_GOT_TABLE)
                {
                    char out[10000];
                    const DataStructures::Table *games =
                        phpDirectoryServer.GetLastDownloadedTable();
                    games->PrintColumnHeaders(out, sizeof(out), ',');
                    printf("COLUMNS: %s\n", out);

                    for (unsigned i = 0; i < games->GetRowCount(); i++)
                    {
                        games->PrintRow(out, sizeof(out), ',', true,
                            games->GetRowByIndex(i, NULL));
                        printf("ROW %i: %s\n", i + 1, out);
                    }
                }
            }
        }
    }

    tcp.DeallocatePacket(packet);
}
httpConnection.Update();
phpDirectoryServer.Update();
```

### Reserved columns

Certain columns are reserved and returned to you in a query. These column names are not allowed for use by the end-user, and will assert if attempted:

| Constant | Description |
|---|---|
| `__GAME_NAME` | Contains the name of the game, passed to `UploadTable()` |
| `__GAME_PORT` | Contains the port of the game, passed to `UploadTable()` |
| `__SEC_AFTER_EPOCH_SINCE_LAST_UPDATE` | When this row was last updated |
| `__DELETE_ROW` | Command to delete a row (internal) |
| `__PHP_DIRECTORY_SERVER_PASSWORD` | Password passed to the PHP server (internal) |
| `__GAME_LISTING_TIMEOUT` | How long to list this server before auto expiring (internal) |

`__SYSTEM_ADDRESS` will also be returned indicating the external IP that was used to upload to the webpage.

<Callout type="info">
Due to technical limitations only one upload can be processed at a time. This is not a problem if your server is only hosting one game. Calling `PHPDirectoryServer::UploadTable()` while an upload is pending will overwrite the prior upload. You can perform another upload when `HTTPConnectionIsBusy()` returns false.
</Callout>

## See Also

- [TCP Interface](/utilities/tcp-interface)
