---
title: "Router2"
description: "Route datagrams between two systems that cannot directly connect by forwarding through an intermediate connected peer."
---

## Sending messages through intermediate systems

`Router2` routes datagrams between two systems that are not directly connected by using the bandwidth of a third system, to which the other two systems are connected. It is useful when a fully connected mesh topology is desired but cannot be completely established due to routers and/or firewalls. Because the system address of a remote system is the system address of the intermediary, you must use the `RakNetGUID` object to refer to systems, including with other plugins.

<Callout type="info">
When using `Router2`, always refer to remote systems by `RakNetGUID` rather than `SystemAddress`, since the address of a routed connection will be the address of the intermediary, not the actual destination.
</Callout>

**To use:**

Attach one instance of the `Router2` plugin to each system.

Call `EstablishRouting` with the `RakNetGUID` of the destination system.

A message is broadcast to all connected instances of `RakPeer`. For each instance running the `Router2` plugin, the connection list is queried to determine who, if anyone, is connected to the target system.

After all systems are queried, the system with the lowest total ping that is also forwarding the fewest connections starts the `UDPForwarder` system and returns `ID_ROUTER_2_FORWARDING_ESTABLISHED`. If no path is available, `ID_ROUTER_2_FORWARDING_NO_PATH` is returned instead.

Once a path is established, connect to the target system as usual:

```cpp
RakNet::BitStream bs(packet->data, packet->length, false);
bs.IgnoreBytes(sizeof(MessageID));
RakNetGUID endpointGuid;
bs.Read(endpointGuid);
unsigned short sourceToDestPort;
bs.Read(sourceToDestPort);
char ipAddressString[32];
packet->systemAddress.ToString(false, ipAddressString);
rakPeerInterface->EstablishRouting(ipAddressString, sourceToDestPort, 0, 0);
```

Rerouting happens automatically. When a connection is rerouted, you receive `ID_ROUTER_2_REROUTED`. While the `SystemAddress` changes, the `RakNetGUID` does not. Therefore, you must refer to the target system using `RakNetGUID` when using this plugin.
