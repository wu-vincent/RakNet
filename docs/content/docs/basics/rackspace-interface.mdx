---
title: "C++ Interface to Rackspace Cloud Servers API"
description: "How to programmatically manage Rackspace cloud servers from C++ using the RakNet Rackspace class and TCPInterface."
---

## Programmatic server management

Rackspace provides an HTTPS-based API. RakNet supports HTTPS when using the class [`TCPInterface`](/utilities/tcp-interface) and compiled with `OPEN_SSL_CLIENT_SUPPORT` set to `1`, defined in `RakNetDefines.h`.

**Setup:**

```cpp
#include "Rackspace.h"
#include "TCPInterface.h"
```

```cpp
RakNet::Rackspace rackspaceApi;
RakNet::TCPInterface tcpInterface;
RakNet::RackspaceEventCallback_Default callback;
tcpInterface.Start(0, 0, 1);
rackspaceAPI.Authenticate(&tcpInterface, "myAuthURL", "myRackspaceUsername", "myRackspaceAPIKey");
while (1) {
    for (RakNet::Packet *packet = tcpInterface.Receive(); packet;
         tcpInterface.DeallocatePacket(packet), packet = tcpInterface.Receive()) {
        rackspaceApi.OnReceive(packet);
    }
    rackspaceApi.OnClosedConnection(tcpInterface.HasLostConnection());
}
```

The first three lines create an instance of `TCPInterface`, `Rackspace`, and the event handler for `Rackspace` respectively. The fourth line starts the `TCPInterface` class so outgoing connections can be initiated. The call to `Authenticate` logs into Rackspace and internally stores a key that can be used for subsequent operations. See the comments in `Rackspace.h` with the `Authenticate()` function for more details on these parameters. The two lines in the inner loop pass connection events to the Rackspace class.

On successful authentication, `Authenticate` returns something other than `UNASSIGNED_SYSTEM_ADDRESS` to indicate the connection completed. Shortly thereafter, the callback `OnAuthenticationResult` fires with `eventType` set to `RET_Success_204`. After that, you can call the other functions exposed by the Rackspace class.

<Callout type="warn">
If the connection is immediately closed with no response from the server, you probably forgot to compile with `OPEN_SSL_CLIENT_SUPPORT` set to `1` in RakNetDefines.h or RakNetDefinesOverrides.h.
</Callout>

**Example of listing images:**

```cpp
rackspaceApi.ListImages();
```

Wait for callback `OnListImagesResult(RackspaceEventType eventType, const char *htmlAdditionalInfo)`

The callback returns HTTP status codes 200, 203, 400, 500, 503, 401, or 413. Codes 200 and 203 indicate success. The status code is returned in the `eventType` parameter. The actual response body is returned in `htmlAdditionalInfo`. Example output:

```text
HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
vary: Accept, Accept-Encoding, X-Auth-Token
Last-Modified: Tue, 29 Mar 2011 22:41:36 GMT
X-PURGE-KEY: /570016/images
Cache-Control: s-maxage=1800
Content-Type: application/xml
Content-Length: 1334
Date: Sat, 02 Apr 2011 15:15:19 GMT
X-Varnish: 601046147
Age: 0
Via: 1.1 varnish
Connection: keep-alive
```

```xml
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<images
	xmlns="http://docs.rackspacecloud.com/servers/api/v1.0">
	<image name="Windows Server 2008 R2 x64 - MSSQL2K8R2" id="58"/>
	<image name="Fedora 14" id="71"/>
	<image name="Red Hat Enterprise Linux 5.5" id="62"/>
	<image name="Windows Server 2003 R2 SP2 x86" id="29"/>
	<image name="Oracle EL Server Release 5 Update 4" id="40"/>
	<image name="Windows Server 2003 R2 SP2 x64" id="23"/>
	<image name="Gentoo 10.1" id="19"/>
	<image name="Windows Server 2008 SP2 x86" id="31"/>
	<image name="Windows Server 2008 SP2 x64 - MSSQL2K8R2" id="57"/>
	<image name="Ubuntu 9.10 (karmic)" id="14362"/>
	<image name="Ubuntu 10.04 LTS (lucid)" id="49"/>
	<image name="Arch 2010.05" id="55"/>
	<image name="Oracle EL JeOS Release 5 Update 3" id="41"/>
	<image name="Ubuntu 8.04.2 LTS (hardy)" id="10"/>
	<image name="CentOS 5.4" id="187811"/>
	<image name="Fedora 13" id="53"/>
	<image name="Windows Server 2008 SP2 x64" id="24"/>
	<image name="CentOS 5.5" id="51"/>
	<image name="Ubuntu 10.10 (maverick)" id="69"/>
	<image name="Windows Server 2008 R2 x64" id="28"/>
	<image name="Windows Server 2008 SP2 x86 - MSSQL2K8R2" id="56"/>
	<image name="Red Hat Enterprise Linux 5.4" id="14"/>
	<image name="Debian 5.0 (lenny)" id="4"/>
	<image name="Ubuntu256MBBigPacketTest" id="9438184"/>
	<image name="RakNet-setup" id="9019637"/>
</images>
```

RakNet does not parse the XML for you. An XML parser is available at DependentExtensions/XML if you do not have your own.

**Executing custom commands:**

Rackspace provides an XML Schema with the list of operations and parameters for the API. Some commands are more complex than what the `Rackspace` class exposes. For these commands, call `Rackspace::AddOperation()` directly. For example, the following creates a server:

```cpp
RakNet::RakString xml("<?xml version=\"1.0\" encoding=\"UTF-8\"?>"
                      "<server xmlns=\"http://docs.rackspacecloud.com/servers/api/v1.0\" "
                      "name=\"%s\" imageId=\"%s\" flavorId=\"%s\">"
                      "</server>",
                      name.C_String(),
                      imageId.C_String(),
                      flavorId.C_String());
AddOperation(RO_CREATE_SERVER, "POST", "servers", xml);
```

You could extend the XML to support loading an image with files, for example.

**Examples of server management with RakNet:**

Reboot crashed servers - Run one master server that monitors the other servers. The master server can be at a fixed IP address, or you can use DynDNS (a C++ DynDNS class is available under /Source). When you start a Rackspace server, have it connect to the master server. If the master server receives `ID_CONNECTION_LOST`, have it call `Rackspace::RebootServer`.

Matching capacity - Again run a master server. Using `CloudServer` and `CloudClient`, inform the master server of the current connection load of each Rackspace server. If all servers are full or nearly so, use `Rackspace::CreateServer` to create a new server instance based on an image of your application. Similarly, if a server is completely empty, you can use `Rackspace::DeleteServer` to not incur the extra cost.

<Callout type="info">
Note that the MasterServer2 service previously hosted at `masterserver2.raknet.com` is now defunct.
</Callout>
