---
title: "StringCompressor"
description: Encode and decode strings safely with Huffman compression and predefined string tables.
---

`StringCompressor`, found in `StringCompressor.h`, encodes and decodes strings safely, protecting against buffer overruns.

Sender:

```cpp
const char *str = "My string";
stringCompressor->EncodeString(str, TRUNCATION_LENGTH, &bitStream, languageId);
```

Receiver:

```cpp
char buffer[TRUNCATION_LENGTH];
stringCompressor->DecodeString(buffer, TRUNCATION_LENGTH, &bitStream, languageId);
```

The first parameter is the string to encode or decode. The second parameter is the maximum number of characters to read or write. If the string exceeds this length, only that many bytes are sent or read. The third parameter is the bitstream to write to or read from. The last parameter specifies the character frequency table, which must match on both systems.

The string is compressed using Huffman encoding based on the frequency table identified by `languageId`. The default frequency table at index 0 is statically defined in `StringCompressor.h` with the variable `englishCharacterFrequencies`. To add your own frequency tables, call `GenerateTreeFromStrings()` with the desired language ID.

<Callout type="info">
If your application is using the `CString` class, you can enable support for this by defining `_CSTRING_COMPRESSOR` in `StringCompressor.h`. Similarly, if your application is using `std::string`, you can enable support by defining `_STD_STRING_COMPRESSOR` in `StringCompressor.h`.
</Callout>

## StringTable

`StringTable` is identical to `StringCompressor`, with the addition of the `AddString` function.

```cpp
void AddString(const char *str, bool copyString);
```

`str` is the string to add. Set `copyString` to true if the string is not persistent, or false if it resides in static memory (only a pointer is stored).

`AddString` checks an internal array to see if the string is already registered. If not, it stores a two-byte identifier representing the string. Subsequent sends using `StringTable` transmit only that two-byte identifier instead of the full string, reducing bandwidth for strings of 3 or more characters. If you send a string not previously added with `AddString()`, the function behaves the same as `stringCompressor`, at the cost of 1 extra bit.

<Callout type="warn">
Both systems must have the same set of strings registered in advance, in the same order, and both systems must use `StringTable` and `StringCompressor` in the corresponding send and receive calls. You cannot mix and match the two.
</Callout>
